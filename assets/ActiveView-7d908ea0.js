import{k as K,F as J,r as b,l as se,D as p,$ as Q,m as u,n as _,w as f,p as x,q as P,t as d,v as q,G as A,z as C,x as o,a0 as R,I as v,O as y,L as U,M as j,K as oe,a1 as z,a2 as ne,a3 as Y,Q as V,B as H,U as Z,a4 as ee,a5 as re,W as le,A as ae,_ as ue,H as ie,J as ce}from"./index-170dd336.js";import{Q as de}from"./QForm-26a44a0f.js";import{_ as ve}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-82087cdf.js";import{Q as me}from"./QBadge-0e554717.js";import{u as te}from"./useDialogs-6c345aa6.js";import{u as pe}from"./useRouting-4a9b1b1e.js";import"./action-99601140.js";import"./QSelect-849a2434.js";import"./QItem-211902f6.js";import"./QItemLabel-4aba8a18.js";import"./QMenu-520beef8.js";import"./selection-79118853.js";import"./QSpace-e07f5388.js";import"./ErrorStates.vue_vue_type_script_setup_true_lang-418685a4.js";import"./ui-9729b3cb.js";const fe={class:"text-h6"},xe={class:"row q-mb-sm"},Ee={class:"col"},ge={key:0,class:"column reverse"},_e={class:"absolute-top-right q-ma-xs"},ke={key:0},be={class:"col"},he={class:"row q-mt-xs"},ye=K({__name:"ActiveExerciseCard",props:{parentExercise:{},exerciseResult:{}},setup(G){const k=G,{log:I}=J(),{confirmDialog:O,dismissDialog:B}=te(),m=b(k.parentExercise),s=b(k.exerciseResult),S=b([]),l=b([]);se(async()=>{S.value=await p.getPreviousExerciseResults(k.parentExercise.id),(k.parentExercise.exerciseInputs||[]).forEach(e=>{var r;Object.values(Q).includes(e)&&w((r=s.value)==null?void 0:r[p.getFieldForInput(e)])})});function w(t){l.value=new Array((t==null?void 0:t.length)||0).fill(null)}function D(){l.value.length>0&&l.value.length<R.MAX_SETS&&((k.parentExercise.exerciseInputs||[]).forEach(e=>{var r,i;Object.values(Q).includes(e)&&((r=s.value)==null||r[p.getFieldForInput(e)].push(null),w((i=s.value)==null?void 0:i[p.getFieldForInput(e)]))}),$())}function L(){O("Remove Last Set","Are you sure you want to remove the last set?",v.REMOVE_SET,"warning",async()=>{try{l.value.length>1&&((k.parentExercise.exerciseInputs||[]).forEach(e=>{var r,i;Object.values(Q).includes(e)&&((r=s.value)==null||r[p.getFieldForInput(e)].pop(),w((i=s.value)==null?void 0:i[p.getFieldForInput(e)]))}),$())}catch(t){I.error("Failed to remove last set",t)}})}async function $(){return await p.putActiveRecord(Z.EXERCISE_RESULTS,ee(!0,{},s.value))}async function M(){var t;return s.value.note=(t=s.value.note)==null?void 0:t.trim(),await $()}function X(t,e){var r,i;if(t===re.WEIGHT)return n(e);{const c=(r=m.value)==null?void 0:r.previousChild;return(i=c==null?void 0:c[t])!=null&&i[e]?`${c[t][e]}`:"No previous value"}}function n(t){var E,h,T,F;const e=S.value,r=e.length>5?5:e.length;let i="No previous value",c="";for(let g=0;g<r;g++){const N=(h=(E=e[g])==null?void 0:E.weightLbs)==null?void 0:h[t];N&&(g===0?i=`${N}`:(c+=`${((F=(T=e[g-1])==null?void 0:T.weightLbs)==null?void 0:F[t])||0-N||0}`,g<r-1&&(c+=", ")))}return c.endsWith(", ")&&(c=c.slice(0,-2)),c?`${i} ← ${c}`:i}function a(t){B("Previous Exercise Note",t,v.NOTE)}return(t,e)=>(u(),_(H,null,{default:f(()=>[x(P,null,{default:f(()=>{var r,i,c;return[d("p",fe,q(m.value.name),1),d("div",xe,[d("div",Ee,q(m.value.desc),1),(r=m.value)!=null&&r.multipleSets?(u(),A("div",ge,[d("div",null,[x(C,{disable:l.value.length>=o(R).MAX_SETS,color:"positive",class:"q-ml-sm",round:"",icon:o(v).ADD,onClick:e[0]||(e[0]=E=>D())},null,8,["disable","icon"]),x(C,{disable:l.value.length<=1,color:"negative",class:"q-ml-sm",round:"",icon:o(v).REMOVE,onClick:e[1]||(e[1]=E=>L())},null,8,["disable","icon"])])])):y("",!0),d("div",_e,[(c=(i=m.value)==null?void 0:i.previousChild)!=null&&c.note?(u(),_(C,{key:0,flat:"",round:"",icon:o(v).NOTE,color:"info",onClick:e[2]||(e[2]=E=>a(m.value.previousChild.note))},null,8,["icon"])):y("",!0)])]),l.value.length>0?(u(),A("div",ke,[(u(!0),A(U,null,j(l.value,(E,h)=>{var T,F;return u(),A("div",{key:h,class:"row q-mb-md"},[(T=m.value)!=null&&T.multipleSets?(u(),_(me,{key:0,size:"lg",color:"secondary",class:"text-bold text-body1 q-mr-sm"},{default:f(()=>[oe(q(h+1),1)]),_:2},1024)):y("",!0),d("div",be,[d("div",he,[(u(!0),A(U,null,j((F=m.value)==null?void 0:F.exerciseInputs,(g,N)=>(u(),_(z,{key:N,"stack-label":"",class:"col-6 q-mb-xs",type:"number",filled:"",square:"",dense:"",modelValue:s.value[o(p).getFieldForInput(g)][h],"onUpdate:modelValue":W=>s.value[o(p).getFieldForInput(g)][h]=W,modelModifiers:{number:!0},rules:[W=>o(ne).safeParse(W).success||"Required"],label:g,hint:X(o(p).getFieldForInput(g),h),onBlur:e[3]||(e[3]=W=>$())},null,8,["modelValue","onUpdate:modelValue","rules","label","hint"]))),128))])])])}),128))])):y("",!0),x(z,{label:`${m.value.name} notes`,modelValue:s.value.note,"onUpdate:modelValue":e[5]||(e[5]=E=>s.value.note=E),rules:[E=>o(Y).safeParse(E).success||`Note cannot exceed ${o(R).MAX_TEXT_AREA} characters`],maxlength:o(R).MAX_TEXT_AREA,type:"textarea","lazy-rules":"",autogrow:"",counter:"",dense:"",outlined:"",color:"primary",onBlur:e[6]||(e[6]=E=>M())},{prepend:f(()=>[x(V,{name:o(v).NOTE},null,8,["name"])]),append:f(()=>[s.value.note!==""?(u(),_(V,{key:0,name:o(v).CANCEL,onClick:e[4]||(e[4]=E=>s.value.note=""),class:"cursor-pointer"},null,8,["name"])):y("",!0)]),_:1},8,["label","modelValue","rules","maxlength"])]}),_:1})]),_:1}))}}),we=d("p",{class:"text-h6"},"Workout Description",-1),$e={class:"absolute-top-right q-ma-xs"},Ae=d("p",{class:"text-h6"},"Workout Notes",-1),Re={class:"row justify-center q-my-sm"},Se={class:"row justify-center"},Te=d("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),Ue=K({__name:"ActiveView",setup(G){le({title:`${ae} - Active Workout`});const{log:k}=J(),{confirmDialog:I,dismissDialog:O}=te(),{goToDashboard:B}=pe(),m=b(!0),s=b({}),S=b([]),l=b({}),w=b([]),D=p.liveActiveWorkout().subscribe({next:n=>{s.value=n.parentWorkout,S.value=n.parentExercises,l.value=n.workoutResult,w.value=n.exerciseResults},error:n=>k.error("Error fetching live Active Workout",n)});ue(()=>{D.unsubscribe()});async function L(){I("Finish Workout","Are you ready to finish and save this workout?",v.SAVE,"positive",async()=>{try{await p.finishWorkout(),B()}catch(n){k.error("Failed to save active workout",n)}})}function $(n){return S.value.find(a=>a.id===n)||{}}function M(n){O("Previous Workout Note",n,v.NOTE)}async function X(){var n;return l.value.note=(n=l.value.note)==null?void 0:n.trim(),await p.putActiveRecord(Z.WORKOUT_RESULTS,ee(!0,{},l.value))}return(n,a)=>(u(),_(ve,null,{default:f(()=>[x(de,{onSubmit:L,onValidationError:a[4]||(a[4]=t=>m.value=!1),onValidationSuccess:a[5]||(a[5]=t=>m.value=!0)},{default:f(()=>[s.value.desc?(u(),_(H,{key:0,class:"q-mt-sm q-mb-md"},{default:f(()=>[x(P,null,{default:f(()=>{var t,e;return[we,d("div",null,q(s.value.desc),1),d("div",$e,[(e=(t=s.value)==null?void 0:t.previousChild)!=null&&e.note?(u(),_(C,{key:0,flat:"",round:"",icon:o(v).NOTE,color:"info",onClick:a[0]||(a[0]=r=>M(s.value.previousChild.note))},null,8,["icon"])):y("",!0)])]}),_:1})]),_:1})):y("",!0),(u(!0),A(U,null,j(w.value,t=>(u(),_(ye,{key:t.id,parentExercise:$(t.parentId),exerciseResult:t,class:"q-mb-md"},null,8,["parentExercise","exerciseResult"]))),128)),x(H,{class:"q-mt-sm q-mb-md"},{default:f(()=>[x(P,null,{default:f(()=>[Ae,x(z,{label:`${s.value.name} notes`,modelValue:l.value.note,"onUpdate:modelValue":a[2]||(a[2]=t=>l.value.note=t),rules:[t=>o(Y).safeParse(t).success||`Note cannot exceed ${o(R).MAX_TEXT_AREA} characters`],maxlength:o(R).MAX_TEXT_AREA,type:"textarea","lazy-rules":"",autogrow:"",counter:"",dense:"",outlined:"",color:"primary",onBlur:a[3]||(a[3]=t=>X())},{prepend:f(()=>[x(V,{name:o(v).NOTE},null,8,["name"])]),append:f(()=>[l.value.note!==""?(u(),_(V,{key:0,name:o(v).CANCEL,onClick:a[1]||(a[1]=t=>l.value.note=""),class:"cursor-pointer"},null,8,["name"])):y("",!0)]),_:1},8,["label","modelValue","rules","maxlength"])]),_:1})]),_:1}),d("div",Re,[x(C,{label:"Finish Workout",type:"submit",color:"positive",icon:o(v).SAVE},null,8,["icon"])]),ie(d("div",Se,[x(V,{name:o(v).WARN,color:"warning"},null,8,["name"]),Te],512),[[ce,!m.value]])]),_:1})]),_:1}))}});export{Ue as default};
