import{k as K,F as J,r as b,l as se,D as m,$ as Q,m as i,n as g,w as p,p as f,q as P,t as c,v as W,G as R,z as N,x as o,a0 as S,I as d,O as w,L as U,M as j,K as oe,a1 as z,a2 as re,a3 as Y,Q as C,B as H,U as Z,a4 as ee,a5 as ne,W as le,A as ae,_ as ue,H as ie,J as ce}from"./index-f9e48ce5.js";import{Q as de}from"./QForm-6b6dcb15.js";import{_ as ve}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-e03ce09d.js";import{Q as me}from"./QBadge-b83ec4ab.js";import{u as te}from"./useDialogs-f6db2f77.js";import{u as pe}from"./useRouting-b4b02656.js";import"./action-185c191f.js";import"./QSelect-d229d2fe.js";import"./QItem-6d4dfdac.js";import"./QItemLabel-d986f4e4.js";import"./QMenu-13cc82f0.js";import"./selection-eb58c8c8.js";import"./QSpace-fdabfba9.js";import"./ErrorStates.vue_vue_type_script_setup_true_lang-d8b6fb67.js";import"./ui-48790129.js";const fe={class:"text-h6"},xe={class:"row q-mb-sm"},Ee={class:"col"},ge={key:0,class:"column reverse"},_e={class:"absolute-top-right q-ma-xs"},ke={key:0},be={class:"col"},he={class:"row q-mt-xs"},ye=K({__name:"ActiveExerciseCard",props:{parentExercise:{},exerciseResult:{}},setup(G){const _=G,{log:q}=J(),{confirmDialog:I,dismissDialog:O}=te(),v=b(_.parentExercise),s=b(_.exerciseResult),T=b([]),a=b([]);se(async()=>{T.value=await m.getPreviousExerciseResults(_.parentExercise.id),(_.parentExercise.exerciseInputs||[]).forEach(t=>{var r;Object.values(Q).includes(t)&&$((r=s.value)==null?void 0:r[m.getFieldForInput(t)])})});function $(e){a.value=new Array((e==null?void 0:e.length)||0).fill(null)}function B(){a.value.length>0&&a.value.length<S.MAX_SETS&&((_.parentExercise.exerciseInputs||[]).forEach(t=>{var r,n;Object.values(Q).includes(t)&&((r=s.value)==null||r[m.getFieldForInput(t)].push(null),$((n=s.value)==null?void 0:n[m.getFieldForInput(t)]))}),A())}function D(){I("Remove Last Set","Are you sure you want to remove the last set?",d.REMOVE_SET,"warning",async()=>{try{a.value.length>1&&((_.parentExercise.exerciseInputs||[]).forEach(t=>{var r,n;Object.values(Q).includes(t)&&((r=s.value)==null||r[m.getFieldForInput(t)].pop(),$((n=s.value)==null?void 0:n[m.getFieldForInput(t)]))}),A())}catch(e){q.error("Failed to remove last set",e)}})}async function A(){return await m.putActiveRecord(Z.EXERCISE_RESULTS,ee(!0,{},s.value))}async function M(){var e;return s.value.note=(e=s.value.note)==null?void 0:e.trim(),await A()}function L(e,t){var r,n;if(e===ne.WEIGHT)return l(t);{const E=(r=v.value)==null?void 0:r.previousChild;return(n=E==null?void 0:E[e])!=null&&n[t]?`${E[e][t]}`:"No previous value"}}function l(e){var E,x,h,F;const t=T.value;let r="No previous value",n="";for(let k=0;k<6;k++){const y=((x=(E=t[k])==null?void 0:E.weightLbs)==null?void 0:x[e])??0;if(y!==void 0)if(k===0)r=`${y}`;else{const X=((F=(h=t[k-1])==null?void 0:h.weightLbs)==null?void 0:F[e])??0;n+=`${X-y}`,k<6-1&&(n+=", ")}}return n.endsWith(", ")&&(n=n.slice(0,-2)),n?`${r} ← ${n}`:r}function u(e){O("Previous Exercise Note",e,d.NOTE)}return(e,t)=>(i(),g(H,null,{default:p(()=>[f(P,null,{default:p(()=>{var r,n,E;return[c("p",fe,W(v.value.name),1),c("div",xe,[c("div",Ee,W(v.value.desc),1),(r=v.value)!=null&&r.multipleSets?(i(),R("div",ge,[c("div",null,[f(N,{disable:a.value.length>=o(S).MAX_SETS,color:"positive",class:"q-ml-sm",round:"",icon:o(d).ADD,onClick:t[0]||(t[0]=x=>B())},null,8,["disable","icon"]),f(N,{disable:a.value.length<=1,color:"negative",class:"q-ml-sm",round:"",icon:o(d).REMOVE,onClick:t[1]||(t[1]=x=>D())},null,8,["disable","icon"])])])):w("",!0),c("div",_e,[(E=(n=v.value)==null?void 0:n.previousChild)!=null&&E.note?(i(),g(N,{key:0,flat:"",round:"",icon:o(d).NOTE,color:"info",onClick:t[2]||(t[2]=x=>u(v.value.previousChild.note))},null,8,["icon"])):w("",!0)])]),a.value.length>0?(i(),R("div",ke,[(i(!0),R(U,null,j(a.value,(x,h)=>{var F,k;return i(),R("div",{key:h,class:"row q-mb-md"},[(F=v.value)!=null&&F.multipleSets?(i(),g(me,{key:0,size:"lg",color:"secondary",class:"text-bold text-body1 q-mr-sm"},{default:p(()=>[oe(W(h+1),1)]),_:2},1024)):w("",!0),c("div",be,[c("div",he,[(i(!0),R(U,null,j((k=v.value)==null?void 0:k.exerciseInputs,(y,X)=>(i(),g(z,{key:X,"stack-label":"",class:"col-6 q-mb-xs",type:"number",step:"0.05",filled:"",square:"",dense:"",modelValue:s.value[o(m).getFieldForInput(y)][h],"onUpdate:modelValue":V=>s.value[o(m).getFieldForInput(y)][h]=V,modelModifiers:{number:!0},rules:[V=>o(re).safeParse(V).success||"Required"],label:y,hint:L(o(m).getFieldForInput(y),h),onBlur:t[3]||(t[3]=V=>A())},null,8,["modelValue","onUpdate:modelValue","rules","label","hint"]))),128))])])])}),128))])):w("",!0),f(z,{label:`${v.value.name} notes`,modelValue:s.value.note,"onUpdate:modelValue":t[5]||(t[5]=x=>s.value.note=x),rules:[x=>o(Y).safeParse(x).success||`Note cannot exceed ${o(S).MAX_TEXT_AREA} characters`],maxlength:o(S).MAX_TEXT_AREA,type:"textarea","lazy-rules":"",autogrow:"",counter:"",dense:"",outlined:"",color:"primary",onBlur:t[6]||(t[6]=x=>M())},{prepend:p(()=>[f(C,{name:o(d).NOTE},null,8,["name"])]),append:p(()=>[s.value.note!==""?(i(),g(C,{key:0,name:o(d).CANCEL,onClick:t[4]||(t[4]=x=>s.value.note=""),class:"cursor-pointer"},null,8,["name"])):w("",!0)]),_:1},8,["label","modelValue","rules","maxlength"])]}),_:1})]),_:1}))}}),we=c("p",{class:"text-h6"},"Workout Description",-1),$e={class:"absolute-top-right q-ma-xs"},Ae=c("p",{class:"text-h6"},"Workout Notes",-1),Re={class:"row justify-center q-my-sm"},Se={class:"row justify-center"},Te=c("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),Ue=K({__name:"ActiveView",setup(G){le({title:`${ae} - Active Workout`});const{log:_}=J(),{confirmDialog:q,dismissDialog:I}=te(),{goToDashboard:O}=pe(),v=b(!0),s=b({}),T=b([]),a=b({}),$=b([]),B=m.liveActiveWorkout().subscribe({next:l=>{s.value=l.parentWorkout,T.value=l.parentExercises,a.value=l.workoutResult,$.value=l.exerciseResults},error:l=>_.error("Error fetching live Active Workout",l)});ue(()=>{B.unsubscribe()});async function D(){q("Finish Workout","Are you ready to finish and save this workout?",d.SAVE,"positive",async()=>{try{await m.finishWorkout(),O()}catch(l){_.error("Failed to save active workout",l)}})}function A(l){return T.value.find(u=>u.id===l)||{}}function M(l){I("Previous Workout Note",l,d.NOTE)}async function L(){var l;return a.value.note=(l=a.value.note)==null?void 0:l.trim(),await m.putActiveRecord(Z.WORKOUT_RESULTS,ee(!0,{},a.value))}return(l,u)=>(i(),g(ve,null,{default:p(()=>[f(de,{onSubmit:D,onValidationError:u[4]||(u[4]=e=>v.value=!1),onValidationSuccess:u[5]||(u[5]=e=>v.value=!0)},{default:p(()=>[s.value.desc?(i(),g(H,{key:0,class:"q-mt-sm q-mb-md"},{default:p(()=>[f(P,null,{default:p(()=>{var e,t;return[we,c("div",null,W(s.value.desc),1),c("div",$e,[(t=(e=s.value)==null?void 0:e.previousChild)!=null&&t.note?(i(),g(N,{key:0,flat:"",round:"",icon:o(d).NOTE,color:"info",onClick:u[0]||(u[0]=r=>M(s.value.previousChild.note))},null,8,["icon"])):w("",!0)])]}),_:1})]),_:1})):w("",!0),(i(!0),R(U,null,j($.value,e=>(i(),g(ye,{key:e.id,parentExercise:A(e.parentId),exerciseResult:e,class:"q-mb-md"},null,8,["parentExercise","exerciseResult"]))),128)),f(H,{class:"q-mt-sm q-mb-md"},{default:p(()=>[f(P,null,{default:p(()=>[Ae,f(z,{label:`${s.value.name} notes`,modelValue:a.value.note,"onUpdate:modelValue":u[2]||(u[2]=e=>a.value.note=e),rules:[e=>o(Y).safeParse(e).success||`Note cannot exceed ${o(S).MAX_TEXT_AREA} characters`],maxlength:o(S).MAX_TEXT_AREA,type:"textarea","lazy-rules":"",autogrow:"",counter:"",dense:"",outlined:"",color:"primary",onBlur:u[3]||(u[3]=e=>L())},{prepend:p(()=>[f(C,{name:o(d).NOTE},null,8,["name"])]),append:p(()=>[a.value.note!==""?(i(),g(C,{key:0,name:o(d).CANCEL,onClick:u[1]||(u[1]=e=>a.value.note=""),class:"cursor-pointer"},null,8,["name"])):w("",!0)]),_:1},8,["label","modelValue","rules","maxlength"])]),_:1})]),_:1}),c("div",Re,[f(N,{label:"Finish Workout",type:"submit",color:"positive",icon:o(d).SAVE},null,8,["icon"])]),ie(c("div",Se,[f(C,{name:o(d).WARN,color:"warning"},null,8,["name"]),Te],512),[[ce,!v.value]])]),_:1})]),_:1}))}});export{Ue as default};
