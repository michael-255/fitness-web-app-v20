import{k as D,W as I,A as R,F as $,D as c,r as B,l as C,a4 as g,_ as V,m as t,n as f,w as y,x as e,G as a,p as l,L as A,M as S,z as w,I as s,t as _,H as F,J as L,Q,au as T}from"./index-f9e48ce5.js";import{Q as U}from"./QForm-6b6dcb15.js";import{_ as q}from"./ErrorStates.vue_vue_type_script_setup_true_lang-d8b6fb67.js";import{_ as N}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-e03ce09d.js";import{u as j}from"./action-185c191f.js";import{u as M}from"./useDialogs-f6db2f77.js";import{u as W}from"./useRouting-b4b02656.js";import"./QSelect-d229d2fe.js";import"./QItem-6d4dfdac.js";import"./QItemLabel-d986f4e4.js";import"./QMenu-13cc82f0.js";import"./selection-eb58c8c8.js";import"./QSpace-fdabfba9.js";import"./ui-48790129.js";const z={key:0},G={key:0,class:"row justify-center q-my-sm"},H={key:1,class:"row justify-center q-my-sm"},J={class:"row justify-center"},K=_("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),de=D({__name:"EditView",setup(O){I({title:`${R} - Edit Record`});const{routeTable:r,routeId:b,goBack:k}=W(),{log:d}=$(),{confirmDialog:E}=M(),n=j(),m=c.getLabel(r,"singular"),v=c.getFieldComponents(r),u=B(!0);C(async()=>{try{n.table=r;const o=await c.getRecord(r,b);if(o)g(!0,n.record,o);else throw new Error("Record not found")}catch(o){d.error("Error loading edit view",o)}}),V(()=>{n.$reset()});async function h(){E("Update",`Update ${m} record?`,s.EDIT,"positive",async()=>{try{await c.putRecord(r,g(!0,{},n.record)),d.info("Record updated",{table:r,id:n.record.id}),k()}catch(o){d.error("Update failed",o)}})}return(o,i)=>(t(),f(N,{bannerIcon:e(s).EDIT,bannerTitle:`Edit ${e(m)}`},{default:y(()=>[e(m)&&e(v).length>0?(t(),a("div",z,[l(U,{onSubmit:h,onValidationError:i[0]||(i[0]=p=>u.value=!1),onValidationSuccess:i[1]||(i[1]=p=>u.value=!0)},{default:y(()=>[(t(!0),a(A,null,S(e(v),(p,x)=>(t(),a("div",{key:x,class:"q-mb-md"},[(t(),f(T(p)))]))),128)),e(n).record.activated?(t(),a("div",H,[l(w,{disable:"",label:"Active",color:"warning",icon:e(s).LOCK},null,8,["icon"])])):(t(),a("div",G,[l(w,{label:"Update",type:"submit",color:"positive",icon:e(s).SAVE},null,8,["icon"])])),_("div",J,[F(_("div",null,[l(Q,{name:e(s).WARN,color:"warning"},null,8,["name"]),K],512),[[L,!u.value]])])]),_:1})])):(t(),f(q,{key:1,error:"unknown"}))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{de as default};
