import{k as A,U as S,A as I,F as T,D as n,r as x,l as B,V as v,Z as D,m as r,n as c,w as y,x as t,G as l,M as V,L as $,p as _,I as s,z as b,H as h,J as M,t as C,Q as L,am as N,an as F,ao as Q}from"./index-41950ac7.js";import{Q as U}from"./QForm-6f006279.js";import{u as q,_ as j}from"./useDialogs-1043a54c.js";import{_ as z}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-5dbcb203.js";import{u as G}from"./action-0d1cdd0a.js";import{u as H}from"./useRouting-1fbb7896.js";import"./QSelect-fddb2898.js";import"./QItem-49916fcd.js";import"./QItemLabel-16ad465d.js";import"./QMenu-c8c7351d.js";import"./selection-45cefb62.js";import"./ui-faa3ee60.js";const J={key:0,class:"row justify-center q-my-sm"},K={key:1,class:"row justify-center q-my-sm"},O={class:"row justify-center"},P=C("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),le=A({__name:"CreateView",setup(W){S({title:`${I} - Create Record`});const{routeTable:a,routeParentId:d,goBack:w}=H(),{log:m}=T(),{confirmDialog:E}=q(),e=G(),u=n.getLabel(a,"singular"),g=n.getFieldComponents(a),p=x(!0);B(async()=>{try{if(e.table=a,e.record=n.getDefaultActionRecord(a),d&&(e.record.parentId=d,a===v.MEASUREMENT_RESULTS)){const o=await n.getRecord(v.MEASUREMENTS,d);o&&(e.measurementInput=o.measurementInput)}}catch(o){m.error("Error loading create view",o)}}),D(()=>{e.$reset()});async function R(){E("Create",`Create ${u} record?`,s.CREATE,"positive",async()=>{try{e.record.id=N(),e.record.activated=!1,await n.addRecord(a,F(!0,{},e.record)),m.info("Record created",{table:a,id:e.record.id}),w()}catch(o){m.error("Create failed",o)}})}return(o,i)=>(r(),c(z,{bannerIcon:t(s).CREATE,bannerTitle:`Create ${t(u)}`},{default:y(()=>[t(u)&&t(g).length>0?(r(),c(U,{key:0,onSubmit:R,onValidationError:i[0]||(i[0]=f=>p.value=!1),onValidationSuccess:i[1]||(i[1]=f=>p.value=!0)},{default:y(()=>[(r(!0),l($,null,V(t(g),(f,k)=>(r(),l("div",{key:k,class:"q-mb-md"},[(r(),c(Q(f)))]))),128)),t(e).record.activated?(r(),l("div",K,[_(b,{disable:"",label:"Active",color:"warning",icon:t(s).LOCK},null,8,["icon"])])):(r(),l("div",J,[_(b,{label:"Create",type:"submit",color:"positive",icon:t(s).SAVE},null,8,["icon"])])),h(C("div",O,[_(L,{name:t(s).WARN,color:"warning"},null,8,["name"]),P],512),[[M,!p.value]])]),_:1})):(r(),c(j,{key:1,error:"unknown"}))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{le as default};
