import{k as A,W as x,A as E,F as R,D as i,r as $,l as h,_ as B,m as r,n as c,w as v,x as e,G as l,M as D,L as V,p as f,I as a,z as g,H as S,J as F,t as y,Q as I,at as L,a4 as Q,au as T}from"./index-ff52cf3d.js";import{Q as q}from"./QForm-a83c0a99.js";import{_ as N}from"./ErrorStates.vue_vue_type_script_setup_true_lang-73a5f6dd.js";import{_ as j}from"./ResponsivePage.vue_vue_type_script_setup_true_lang-6c9b5b9a.js";import{u as M}from"./action-45ab2598.js";import{u as W}from"./useDialogs-a246c5f8.js";import{u as z}from"./useRouting-b63499da.js";import"./QSelect-645fbe4a.js";import"./QItem-786afa1b.js";import"./QItemLabel-12aca26d.js";import"./QMenu-900fcdd3.js";import"./selection-84b0a129.js";import"./ui-a8e57791.js";const G={key:0,class:"row justify-center q-my-sm"},H={key:1,class:"row justify-center q-my-sm"},J={class:"row justify-center"},K=y("span",{class:"text-caption q-ml-xs text-warning"}," Correct invalid entries and try again ",-1),ce=A({__name:"CreateView",setup(O){x({title:`${E} - Create Record`});const{routeTable:o,goBack:C}=z(),{log:d}=R(),{confirmDialog:b}=W(),t=M(),m=i.getLabel(o,"singular"),_=i.getFieldComponents(o),u=$(!0);h(async()=>{try{t.table=o,t.record=i.getDefaultActionRecord(o)}catch(n){d.error("Error loading create view",n)}}),B(()=>{t.$reset()});async function w(){b("Create",`Create ${m} record?`,a.CREATE,"positive",async()=>{try{t.record.id=L(),t.record.activated=!1,await i.addRecord(o,Q(!0,{},t.record)),d.info("Record created",{table:o,id:t.record.id}),C()}catch(n){d.error("Create failed",n)}})}return(n,s)=>(r(),c(j,{bannerIcon:e(a).CREATE,bannerTitle:`Create ${e(m)}`},{default:v(()=>[e(m)&&e(_).length>0?(r(),c(q,{key:0,onSubmit:w,onValidationError:s[0]||(s[0]=p=>u.value=!1),onValidationSuccess:s[1]||(s[1]=p=>u.value=!0)},{default:v(()=>[(r(!0),l(V,null,D(e(_),(p,k)=>(r(),l("div",{key:k,class:"q-mb-md"},[(r(),c(T(p)))]))),128)),e(t).record.activated?(r(),l("div",H,[f(g,{disable:"",label:"Active",color:"warning",icon:e(a).LOCK},null,8,["icon"])])):(r(),l("div",G,[f(g,{label:"Create",type:"submit",color:"positive",icon:e(a).SAVE},null,8,["icon"])])),S(y("div",J,[f(I,{name:e(a).WARN,color:"warning"},null,8,["name"]),K],512),[[F,!u.value]])]),_:1})):(r(),c(N,{key:1,error:"unknown"}))]),_:1},8,["bannerIcon","bannerTitle"]))}});export{ce as default};
